<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .stat-card { 
            border: 1px solid #ddd; 
            padding: 20px; 
            margin: 10px; 
            border-radius: 8px; 
            display: inline-block;
            min-width: 200px;
        }
        .stat-value { font-size: 2em; font-weight: bold; color: #2563eb; }
        .stat-label { color: #666; margin-top: 5px; }
        .error { color: red; }
        .success { color: green; }
        button { 
            padding: 10px 20px; 
            margin: 10px; 
            background: #2563eb; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer;
        }
        button:hover { background: #1d4ed8; }
        .log { 
            background: #f3f4f6; 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 5px; 
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>Dashboard Test Page</h1>
    
    <div>
        <button onclick="testAnalyticsEndpoint()">Test Analytics Endpoint</button>
        <button onclick="testIndividualEndpoints()">Test Individual Endpoints</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>
    
    <h2>Dashboard Statistics</h2>
    <div class="stat-card">
        <div class="stat-value" id="total-faculty">-</div>
        <div class="stat-label">Total Faculty</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" id="active-projects">-</div>
        <div class="stat-label">Active Projects</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" id="total-publications">-</div>
        <div class="stat-label">Total Publications</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" id="total-funding">-</div>
        <div class="stat-label">Total Funding</div>
    </div>
    
    <h2>Console Log</h2>
    <div class="log" id="log"></div>
    
    <script>
        // Mock CONFIG for testing
        const CONFIG = {
            API_BASE_URL: 'http://localhost:8000/api',
            ENDPOINTS: {
                ANALYTICS_DASHBOARD: '/analytics/dashboard',
                FACULTY: '/faculty/',
                PROJECTS: '/projects/',
                PUBLICATIONS: '/publications/'
            }
        };
        
        // Mock fetchAPI function
        async function fetchAPI(endpoint, options = {}) {
            const response = await fetch(CONFIG.API_BASE_URL + endpoint, options);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        }
        
        // Mock showNotification function
        function showNotification(message, type = 'info') {
            log(`Notification (${type}): ${message}`);
        }
        
        // Log function to display messages
        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        // Test analytics endpoint
        async function testAnalyticsEndpoint() {
            log('🧪 Testing Analytics Endpoint...');
            try {
                const response = await fetch(CONFIG.API_BASE_URL + CONFIG.ENDPOINTS.ANALYTICS_DASHBOARD);
                
                if (response.ok) {
                    const data = await response.json();
                    log('✅ Analytics endpoint working!');
                    log(`📊 Data: ${JSON.stringify(data, null, 2)}`);
                    
                    // Update dashboard
                    updateDashboardFromAnalytics(data);
                } else {
                    log(`❌ Analytics endpoint failed: ${response.status} ${response.statusText}`);
                    const errorText = await response.text();
                    log(`Error details: ${errorText}`);
                }
            } catch (error) {
                log(`❌ Error testing analytics: ${error.message}`);
            }
        }
        
        // Test individual endpoints
        async function testIndividualEndpoints() {
            log('🧪 Testing Individual Endpoints...');
            try {
                const [facultyResponse, projectsResponse, publicationsResponse] = await Promise.all([
                    fetch(CONFIG.API_BASE_URL + CONFIG.ENDPOINTS.FACULTY),
                    fetch(CONFIG.API_BASE_URL + CONFIG.ENDPOINTS.PROJECTS),
                    fetch(CONFIG.API_BASE_URL + CONFIG.ENDPOINTS.PUBLICATIONS)
                ]);
                
                if (facultyResponse.ok && projectsResponse.ok && publicationsResponse.ok) {
                    const facultyData = await facultyResponse.json();
                    const projectsData = await projectsResponse.json();
                    const publicationsData = await publicationsResponse.json();
                    
                    log('✅ All individual endpoints working!');
                    log(`📊 Faculty: ${facultyData.length} records`);
                    log(`📊 Projects: ${projectsData.length} records`);
                    log(`📊 Publications: ${publicationsData.length} records`);
                    
                    // Update dashboard using fallback method
                    updateDashboardFromIndividualEndpoints(facultyData, projectsData, publicationsData);
                } else {
                    log('❌ Some endpoints failed');
                    log(`Faculty: ${facultyResponse.status}`);
                    log(`Projects: ${projectsResponse.status}`);
                    log(`Publications: ${publicationsResponse.status}`);
                }
            } catch (error) {
                log(`❌ Error testing individual endpoints: ${error.message}`);
            }
        }
        
        // Update dashboard from analytics data
        function updateDashboardFromAnalytics(data) {
            document.getElementById('total-faculty').textContent = data.faculty_count || 0;
            document.getElementById('active-projects').textContent = data.active_projects || 0;
            document.getElementById('total-publications').textContent = data.total_publications || 0;
            
            const totalFunding = data.total_budget || data.total_project_budget || 0;
            document.getElementById('total-funding').textContent = `$${(totalFunding / 1000000).toFixed(1)}M`;
            
            log('✅ Dashboard updated from analytics data');
        }
        
        // Update dashboard from individual endpoints
        function updateDashboardFromIndividualEndpoints(facultyData, projectsData, publicationsData) {
            document.getElementById('total-faculty').textContent = facultyData.length || 0;
            document.getElementById('active-projects').textContent = 
                projectsData.filter(p => p.status === 'Active').length || 0;
            document.getElementById('total-publications').textContent = publicationsData.length || 0;
            
            const totalFunding = projectsData.reduce((sum, project) => sum + (project.total_budget || 0), 0);
            document.getElementById('total-funding').textContent = `$${(totalFunding / 1000000).toFixed(1)}M`;
            
            log('✅ Dashboard updated from individual endpoints');
        }
        
        // Clear log
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        // Initialize
        log('🚀 Dashboard Test Page Loaded');
        log('Click buttons above to test endpoints');
    </script>
</body>
</html>
