<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auth Debug - University Research Portal</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome Icons -->
    <link href="https://site-assets.fontawesome.com/releases/v6.4.0/css/all.css" rel="stylesheet">
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation Bar -->
    <nav class="bg-gradient-to-r from-blue-800 to-indigo-900 text-white shadow-xl sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <!-- Logo and Brand -->
                <div class="flex items-center space-x-3">
                    <div class="bg-white rounded-full p-2">
                        <i class="fas fa-university text-blue-800 text-xl"></i>
                    </div>
                    <div>
                        <a href="index.html" class="text-xl font-bold hover:text-blue-200 transition-colors">
                            University Research Portal
                        </a>
                        <p class="text-xs text-blue-200">Debug Page</p>
                    </div>
                </div>

                <!-- Auth Buttons -->
                <div class="auth-buttons flex items-center space-x-3">
                    <button onclick="testAuth('login')" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors font-medium">
                        <i class="fas fa-sign-in-alt mr-2"></i>Test Login
                    </button>
                    <button onclick="testAuth('register')" class="bg-white text-blue-800 hover:bg-gray-100 px-4 py-2 rounded-lg transition-colors font-medium">
                        <i class="fas fa-user-plus mr-2"></i>Test Register
                    </button>
                </div>

                <!-- Profile Section -->
                <div class="profile-section hidden flex items-center space-x-3">
                    <div class="relative group">
                        <button class="flex items-center space-x-2 bg-blue-700 hover:bg-blue-800 px-4 py-2 rounded-lg transition-colors">
                            <i class="fas fa-user-circle text-xl"></i>
                            <span class="profile-name">User</span>
                            <i class="fas fa-chevron-down text-xs"></i>
                        </button>
                        <div class="absolute top-full right-0 mt-2 w-64 bg-white rounded-lg shadow-xl invisible group-hover:visible opacity-0 group-hover:opacity-100 transition-all duration-300">
                            <div class="p-4 border-b border-gray-200">
                                <p class="profile-name font-semibold text-gray-800">User Name</p>
                                <p class="profile-email text-sm text-gray-600">user@email.com</p>
                                <p class="profile-type text-xs text-blue-600 font-medium">User Type</p>
                            </div>
                            <div class="p-2">
                                <a href="pages/profile.html" class="block px-3 py-2 text-gray-700 hover:bg-blue-50 hover:text-blue-800 transition-colors rounded">
                                    <i class="fas fa-user mr-2"></i>Profile
                                </a>
                                <button onclick="testLogout()" class="w-full text-left px-3 py-2 text-gray-700 hover:bg-red-50 hover:text-red-800 transition-colors rounded">
                                    <i class="fas fa-sign-out-alt mr-2"></i>Logout
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
        <div class="text-center">
            <h1 class="text-3xl font-bold text-gray-800 mb-4">Authentication Debug Page</h1>
            <p class="text-gray-600 mb-8">This page helps debug authentication issues</p>
            
            <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Debug Information</h2>
                
                <div class="text-left space-y-4">
                    <div class="p-4 bg-gray-100 rounded-lg">
                        <h3 class="font-semibold mb-2">Auth Object Status:</h3>
                        <p id="auth-status">Checking...</p>
                    </div>
                    
                    <div class="p-4 bg-gray-100 rounded-lg">
                        <h3 class="font-semibold mb-2">Console Logs:</h3>
                        <div id="console-logs" class="bg-black text-green-400 p-3 rounded font-mono text-sm h-32 overflow-y-auto">
                            <div>Console logs will appear here...</div>
                        </div>
                    </div>
                    
                    <div class="p-4 bg-gray-100 rounded-lg">
                        <h3 class="font-semibold mb-2">Test Functions:</h3>
                        <div class="space-y-2">
                            <button onclick="checkAuthObject()" class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                                Check Auth Object
                            </button>
                            <button onclick="testDirectCall()" class="w-full bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition-colors">
                                Test Direct Auth Call
                            </button>
                            <button onclick="clearLogs()" class="w-full bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors">
                                Clear Logs
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/auth.js"></script>
    <script>
        // Override console.log to capture logs
        const originalLog = console.log;
        const originalError = console.error;
        const logContainer = document.getElementById('console-logs');
        
        function addLog(message, type = 'log') {
            const logDiv = document.createElement('div');
            logDiv.className = type === 'error' ? 'text-red-400' : 'text-green-400';
            logDiv.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContainer.appendChild(logDiv);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog(args.join(' '));
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog(args.join(' '), 'error');
        };
        
        // Test functions
        function testAuth(type) {
            console.log(`Test auth called with type: ${type}`);
            console.log('Auth object available:', typeof window.auth);
            console.log('Auth object:', window.auth);
            
            if (window.auth && typeof window.auth.showAuthModal === 'function') {
                console.log('Calling auth.showAuthModal...');
                window.auth.showAuthModal(type);
            } else {
                console.error('Auth object or showAuthModal method not available');
                addLog('ERROR: Auth object or showAuthModal method not available', 'error');
            }
        }
        
        function testLogout() {
            console.log('Test logout called');
            if (window.auth && typeof window.auth.logout === 'function') {
                window.auth.logout();
            } else {
                console.error('Auth object or logout method not available');
            }
        }
        
        function checkAuthObject() {
            console.log('=== Auth Object Check ===');
            console.log('window.auth:', window.auth);
            console.log('typeof window.auth:', typeof window.auth);
            console.log('auth.showAuthModal:', window.auth?.showAuthModal);
            console.log('auth.login:', window.auth?.login);
            console.log('auth.register:', window.auth?.register);
            console.log('auth.logout:', window.auth?.logout);
            console.log('=======================');
            
            // Update status display
            const statusEl = document.getElementById('auth-status');
            if (window.auth) {
                statusEl.innerHTML = `
                    <span class="text-green-600">✓ Auth object available</span><br>
                    <span class="text-sm text-gray-600">Type: ${typeof window.auth}</span><br>
                    <span class="text-sm text-gray-600">Methods: ${Object.getOwnPropertyNames(Object.getPrototypeOf(window.auth)).join(', ')}</span>
                `;
            } else {
                statusEl.innerHTML = `
                    <span class="text-red-600">✗ Auth object not available</span><br>
                    <span class="text-sm text-gray-600">window.auth: ${typeof window.auth}</span>
                `;
            }
        }
        
        function testDirectCall() {
            console.log('=== Testing Direct Auth Call ===');
            try {
                if (window.auth && window.auth.showAuthModal) {
                    window.auth.showAuthModal('login');
                    console.log('Direct call successful');
                } else {
                    console.error('Direct call failed - auth object not available');
                }
            } catch (error) {
                console.error('Direct call error:', error);
            }
            console.log('===============================');
        }
        
        function clearLogs() {
            logContainer.innerHTML = '<div>Console logs cleared...</div>';
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded - checking auth system');
            setTimeout(checkAuthObject, 1000); // Check after 1 second
        });
        
        // Check auth object every 2 seconds
        setInterval(checkAuthObject, 2000);
    </script>
</body>
</html>
